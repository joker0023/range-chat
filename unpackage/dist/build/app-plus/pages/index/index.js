!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,n){"use strict";var o=n(5),i=n(2),r=n(7);var s=Object(r.a)(i.default,o.b,o.c,!1,null,null,"f20a3568",!1,o.a,void 0);(function(t){this.options.style||(this.options.style={}),Vue.prototype.__merge_style&&Vue.prototype.__$appStyle__&&Vue.prototype.__merge_style(Vue.prototype.__$appStyle__,this.options.style),Vue.prototype.__merge_style?Vue.prototype.__merge_style(n(6).default,this.options.style):Object.assign(this.options.style,n(6).default)}).call(s),e.default=s.exports},function(t,e){t.exports={}},function(t,e,n){"use strict";var o=n(3),i=n.n(o);e.default=i.a},function(t,e,n){"use strict";(function(t){function n(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{message:"",mapcontext:null,markers:[],markerObjs:{},messageList:[]}},methods:{send:function(){var t=this;if(t.message)if(t.message.length>40)uni.showToast({title:"\u5410\u69fd\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc740\u5b57",icon:"none"});else{if(t.message.length>20){var e=t.message;e=e.substr(0,20)+"\n"+e.substr(20),t.message=e}t.reoladPosition((function(){t.messageList.unshift({latitude:t.latitude,longitude:t.longitude,message:t.message}),t.sendWsMsg(t.message),t.message=""}))}},showCallout:function(){var t=this,e=[];t.markers.forEach((function(t){Date.now()-t.timeStamp<7e3&&e.push(t)}));for(var o=0;o<10;o++){var i=t.messageList.shift();if(!i)break;var r=t.createMarker(null,i.message,i.latitude,i.longitude);e.push(r)}t.markerObjs={};var s=1;e.forEach((function(e){e.id=s,t.markerObjs[s]=e,s++})),t.markers=e,setTimeout((function(){t.markers=n(t.markers)}),10),setTimeout((function(){t.showCallout()}),500)},createMarker:function(t,e,n,o){return{id:t,latitude:n,longitude:o,iconPath:"/static/marker.png",timeStamp:Date.now(),callout:{display:"ALWAYS",color:"#999",padding:5,borderRadius:10,fontSize:14,content:e}}},reoladPosition:function(e){var n=this;n.getLocation((function(o){t("log","reoladPosition: ",JSON.stringify(o)," at pages/index/index.nvue:152"),n.mapcontext.moveToLocation({latitude:o.latitude,longitude:o.longitude}),n.latitude=o.latitude,n.longitude=o.longitude,e&&e(o)}))},getLocation:function(t){uni.getLocation({type:"gcj02",success:function(e){t&&t(e)}})},resetRegion:function(){var t=this;t.mapcontext.getRegion({complete:function(e){t.southwest=e.southwest,t.northeast=e.northeast}}),t.getLocation((function(e){var n=!1;if(t.latitude&&t.longitude){var o=Math.abs(e.latitude-t.latitude),i=Math.abs(e.longitude-t.longitude);(o>.001||i>.001)&&(n=!0)}else n=!0;n&&(t.latitude=e.latitude,t.longitude=e.longitude,t.sendWsMsg(null))})),setTimeout((function(){t.resetRegion()}),3e3)},checkMsg:function(t){return!(!this.southwest||!this.northeast)&&(t.longitude>this.southwest.longitude&&t.longitude<this.northeast.longitude&&t.latitude>this.southwest.latitude&&t.latitude<this.northeast.latitude)},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},initWebSocket:function(){var e=this;e.sid||(e.sid=e.guid()),e.socketTask=uni.connectSocket({url:"ws://119.29.139.42:9090/ws/"+e.sid,complete:function(){}}),e.socketTask.onOpen((function(){t("log","WebSocket\u8fde\u63a5\u5df2\u6253\u5f00\uff01"," at pages/index/index.nvue:238"),e.reoladPosition((function(t){e.sendWsMsg(null)}))})),e.socketTask.onError((function(n){t("log","WebSocket\u8fde\u63a5\u6253\u5f00\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\uff01",n," at pages/index/index.nvue:244"),e.socketTask=null})),e.socketTask.onClose((function(){t("log","WebSocket\u8fde\u63a5\u5173\u95ed\uff01"," at pages/index/index.nvue:248"),e.socketTask=null})),e.socketTask.onMessage((function(n){t("log","\u6536\u5230\u670d\u52a1\u5668\u5185\u5bb9\uff1a"+n.data," at pages/index/index.nvue:252");var o=JSON.parse(n.data);e.checkMsg(o)&&e.messageList.push({latitude:o.latitude,longitude:o.longitude,message:o.message})}))},sendWsMsg:function(t){if(this.sid&&this.socketTask){var e={sid:this.sid,message:t,longitude:this.longitude,latitude:this.latitude};this.socketTask.send({data:JSON.stringify(e)})}},callouttap:function(e){var n=this.markerObjs[e.detail.markerId];t("log",n," at pages/index/index.nvue:283"),n&&(n.timeStamp=Date.now())},test:function(){}},onReady:function(){var e=this;e.socketTask&&e.socketTask.close(),e.mapcontext=uni.createMapContext("map",e),t("log","on ready"," at pages/index/index.nvue:307"),plus.device.getInfo({success:function(t){e.sid=t.uuid}}),setTimeout((function(){e.reoladPosition(),e.initWebSocket(),e.showCallout(),e.resetRegion()}),1e3),setInterval((function(){e.socketTask||e.initWebSocket()}),5e3)}};e.default=i}).call(this,n(11).default)},function(t,e){t.exports={main:{position:"fixed",left:0,right:0,top:0,bottom:0},"map-container":{position:"absolute",top:0,left:0,right:0,bottom:"50"},map:{position:"absolute",left:0,right:0,top:0,bottom:0},input:{position:"absolute",left:0,right:0,bottom:0,backgroundColor:"#f0f0f0",paddingTop:"8",paddingRight:"90",paddingBottom:"8",paddingLeft:"15",height:"50"},message:{border:"1px solid #66afe9",paddingTop:"6",paddingRight:"12",paddingBottom:"6",paddingLeft:"12",fontSize:"14",lineHeight:"14",color:"#555555",backgroundColor:"#ffffff",borderRadius:"4",height:"34"},"send-btn":{paddingTop:0,paddingRight:"10",paddingBottom:0,paddingLeft:"10",height:"30",position:"absolute",top:"10",right:"10",width:"60"}}},function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("scroll-view",{staticStyle:{flexDirection:"column"},attrs:{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true"}},[n("view",[n("view",{staticClass:["main"]},[n("view",{staticClass:["map-container"]},[n("map",{staticClass:["map"],attrs:{id:"map",showLocation:"true",markers:t.markers},on:{callouttap:t.callouttap}})],1),n("view",{staticClass:["input"]},[n("u-input",{staticClass:["message"],attrs:{type:"text",maxlength:"128",value:t.message},on:{input:function(e){t.message=e.detail.value}}}),n("button",{staticClass:["send-btn"],attrs:{type:"primary",size:"mini"},on:{click:t.send}},[t._v("\u5410\u69fd")])],1)])])])},i=[];n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){}))},function(t,e,n){"use strict";n.r(e);var o=n(4),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e.default=i.a},function(t,e,n){"use strict";function o(t,e,n,o,i,r,s,a,u,l){var c,d="function"==typeof t?t.options:t;if(u){d.components||(d.components={});var f=Object.prototype.hasOwnProperty;for(var p in u)f.call(u,p)&&!f.call(d.components,p)&&(d.components[p]=u[p])}if(l&&((l.beforeCreate||(l.beforeCreate=[])).unshift((function(){this[l.__module]=this})),(d.mixins||(d.mixins=[])).push(l)),e&&(d.render=e,d.staticRenderFns=n,d._compiled=!0),o&&(d.functional=!0),r&&(d._scopeId="data-v-"+r),s?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},d._ssrRegister=c):i&&(c=a?function(){i.call(this,this.$root.$options.shadowRoot)}:i),c)if(d.functional){d._injectStyles=c;var g=d.render;d.render=function(t,e){return c.call(e),g(t,e)}}else{var m=d.beforeCreate;d.beforeCreate=m?[].concat(m,c):[c]}return{exports:t,options:d}}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.r(e);n(9);var o=n(0);"undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(t){const e=this.constructor;return this.then(n=>e.resolve(t()).then(()=>n),n=>e.resolve(t()).then(()=>{throw n}))}),o.default.mpType="page",o.default.route="pages/index/index",o.default.el="#root",new Vue(o.default)},function(t,e,n){Vue.prototype.__$appStyle__={},Vue.prototype.__merge_style&&Vue.prototype.__merge_style(n(10).default,Vue.prototype.__$appStyle__)},function(t,e,n){"use strict";n.r(e);var o=n(1),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e.default=i.a},function(t,e,n){"use strict";function o(t){var e=Object.prototype.toString.call(t);return e.substring(8,e.length-1)}function i(){return"string"==typeof __channelId__&&__channelId__}Object.defineProperty(e,"__esModule",{value:!0}),e.log=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];console[t].apply(console,n)},e.default=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.shift();if(i())return e.push(e.pop().replace("at ","uni-app:///")),console[r].apply(console,e);var s=e.map((function(t){var e=Object.prototype.toString.call(t).toLowerCase();if("[object object]"===e||"[object array]"===e)try{t="---BEGIN:JSON---"+JSON.stringify(t)+"---END:JSON---"}catch(e){t="[object object]"}else if(null===t)t="---NULL---";else if(void 0===t)t="---UNDEFINED---";else{var n=o(t).toUpperCase();t="NUMBER"===n||"BOOLEAN"===n?"---BEGIN:"+n+"---"+t+"---END:"+n+"---":String(t)}return t})),a="";if(s.length>1){var u=s.pop();a=s.join("---COMMA---"),0===u.indexOf(" at ")?a+=u:a+="---COMMA---"+u}else a=s[0];console[r](a)}}]);